#summary OAI Adapter je nástroj umožňující registrátorům vkládat a udržovat aktuální odkazy na zveřejněné instance digitálních dokumentů s přiřazeným URN:NBN.


<wiki:toc max_depth="5" />

= OAI Adapter =
OAI Adapter je nástroj pro ulehčení vkládání a aktualizací digitálních instancí. Je určený pro ty digitální knihovny, které disponují OAI-PMH rozhraním. Skládá se z těchto komponent:
 * OAI Harvester - sklízí záznamy z OAI-PMH rozhraní digitální knihovny
 * Transformer - transformuje sklizené záznamy na data pro _CZIDLO API_. Tedy na vstup operace _registrace digitálního dokument_ a na vstup operace _import digitální instance_. Transformace jsou realizovány pomocí technologie XSLT. Jsou proto potřebné dva XSLT soubory. 
 * Resolver connector - modul přistupující k _CZIDLO API_. Provádí operace _registrace DD_, _import DI_ a některé další.

= Průběh =
OAI Adapter je možné chápat jako proces, jehož jedno spuštění probíhá zjednodušeně takto:
 * Během inicializace se načtou XSL transformace ze souborů, ověří se, zda je pro určeného registrátora povolen vybraný mód registrace, apod.
 * Harvester postupně sklízí záznamy z OAI providera digitální knihovny
 * pro každý záznam pak:
  # Sklizený záznam se transformuje jednak na vstup operace _registrace DD_, jednak na vstup operace _import DI_
  # pokud digitální dokument není v CZIDLO nalezen, je provedena  _registrace digitálního dokumentu_, vstupem je odvozený (transformovaný) ze záznamu z OAI.
  # import digitální instance, deaktivace neaktuální DI
   # pro kombinaci DD + registrátor + digitální knihovna je nalezena DI. Ta může existovat nejvýše jedna DI.
   # pokud taková DI neexistuje, je importovaná nová DI odvozená z OAI záznamu (_připravená DI_)
   # pokud DI existuje a neliší se od _připravené DI_, pokračuje se dalším záznamem
   # pokud se DI liší (změna url, dostupnosti), je aktuální DI deaktivována a importována _připravená DI_. 

OAI Adapter tedy primárně zajišťuje aktuálnost DI. To je potřeba například v těchto situacích:
 * změní se url digitální knihovny a proto i url na jednotlivé tituly, které jsou součástí DI
 * změní se viditelnost některých záznamů. 
 * registrátor nemá nástroje pro registraci DD. Pokud má jeho digitální knihovna OAI-PMH provider, může registrátor použít tento nástroj také k registraci DD, nejen k importu DI.

OAI Adapter prochází všechny záznamy a aktualizuje jen ty, které se změnily.

== Digram průběhu pro jeden záznam ==
_Diagram obsahuje starší terminologii - *import (digitálního dokumentu)* zde znamená *registraci digitálního dokumentu*_.
https://dl.dropboxusercontent.com/u/7787647/resolver-wiki-images/oaiAdapter_single_record.jpg

= Konfigurace =
Konfigurace pro průběh OAI Adapteru se skládá z:
 * konfigurace OAI: url, metadatový prefix, případně _OAI-PMH set_
 * údaje pro CZIDLO API: url, login, heslo, kód registrátora
 * určení XSL transformací _záznam z OAI -> vstup registrace DD_ a _záznam z OAI -> vstup import DI_

= Transformace =
Transformace realizované technologií XSLT jsou použity k výroby xml záznamu v původním formátu do záznamů pro operace registrace DD a import DI. Jsou tedy potřeba dvě transformace. 
== Příklady ==
=== Časopis Duha Moravské zemské knihovny ===
 * [http://duha.mzk.cz/oai?verb=ListRecords&metadataPrefix=oai_dc Původní záznamy poskytnuté OAI Providerem webu Duha ve formátu oai_dc]
 * [http://code.google.com/p/urnnbn-resolver-v2/source/browse/trunk/oaiAdapter/src/main/resources/cz/nkp/urnnbn/oaiadapter/stylesheets/dc_duha_import.xsl Transformace do vstupu operace Registrace DD]
 * [http://code.google.com/p/urnnbn-resolver-v2/source/browse/trunk/oaiAdapter/src/main/resources/cz/nkp/urnnbn/oaiadapter/stylesheets/dc_duha_digital_instance.xsl Transformace do vstupu operace Import DI]
=== Staré mapy MZK ===
 * [http://oai.mzk.cz/MoZaKi/?verb=ListRecords&metadataPrefix=marc21&set=collection:oldMaps Původní záznamy starých map ve formátu marc21 (resp. marcxml)]
 * [http://code.google.com/p/urnnbn-resolver-v2/source/browse/trunk/oaiAdapter/src/main/resources/cz/nkp/urnnbn/oaiadapter/stylesheets/marc21_stmpa_import.xsl Transformace do vstupu operace Registrace DD]
 * [http://code.google.com/p/urnnbn-resolver-v2/source/browse/trunk/oaiAdapter/src/main/resources/cz/nkp/urnnbn/oaiadapter/stylesheets/marc21_stmpa_digital_instance.xsl Transformace do vstupu operace Import DI]
=== Periodika z Krameria MZK ===
 * [http://kramerius.mzk.cz/oaiprovider/?verb=ListRecords&metadataPrefix=oai_dc&set=periodical Záznamy z OAI Provideru Krameria ve formátu oai_dc]
 * [http://code.google.com/p/urnnbn-resolver-v2/source/browse/trunk/oaiAdapter/src/main/resources/cz/nkp/urnnbn/oaiadapter/stylesheets/dc_kramerius_periodical_import.xsl Transformace do vstupu operace Registrace DD]
 * [http://code.google.com/p/urnnbn-resolver-v2/source/browse/trunk/oaiAdapter/src/main/resources/cz/nkp/urnnbn/oaiadapter/stylesheets/dc_kramerius_periodical_digital_instance.xsl Transformace do vstupu operace Import DI]

= Spuštění =
OAI Adapter je možné spouštět dvěma způsoby:

== na serveru (přes webové rozhraní) ==
OAI Adapter je jedním z procesů, které je možné poustět na serveru. Spuštění probíhá přes webové rozhraní. Dialog pro spouštění procesu vyžaduje zadání parametrů, jako je url OAI-PMH provideru atd. Dále je zde nutné vybrat dvě XSL transformace. Webové rozhraní CZIDLO obsahuje jednoduchou správu XSL transformací. Takže je potřeba požadovanou transformaci nejprve na server nahrát a před spuštěním OAI Adapteru zvolit transformaci z dříve nahraných.

== lokálně ==
OAI Adapter je dostupný ve formě jar balíku, viz. sekce Download. Pro jeho spuštění je potřeba Java ve verzi alespoň 1.6. Jediným vstupním parametrem je soubor obsahující konfiguraci. 
{{{
java -jar oaiAdapter-3.0.jar /path/to/configuration.properties
}}}
resp.
{{{
java -jar oaiAdapter-3.0.jar C:\path\to\configuration.properties
}}}
Příklad konfiguračního souboru:
{{{
###################
#  OAI PROVIDER   #
###################
oaiAdapter.oai.baseUrl=http://duha-devel.mzk.cz/oai
oaiAdapter.oai.metadataPrefix=oai_dc
#nepoviné 
#oaiAdapter.oai.setSpec=collection:mollMaps

###################
#    RESOLVER     #
###################
oaiAdapter.resolver.apiUrl=resolver.nkp.cz/api
oaiAdapter.resolver.login=martin
oaiAdapter.resolver.password=*****
oaiAdapter.resolver.registrarCode=duha

##########################
#  XSL TRANSFORMATIONS   #
##########################
oaiAdapter.digDocRegistrationXsl=/home/martin/NetBeansProjects/oaiAdapter/src/main/resources/cz/nkp/urnnbn/oaiadapter/stylesheets/dc_duha_import.xsl
oaiAdapter.digInstImportXsl=/home/martin/NetBeansProjects/oaiAdapter/src/main/resources/cz/nkp/urnnbn/oaiadapter/stylesheets/dc_duha_digital_instance.xsl

######################################
#  XSD FOR RESOLVER OPERATION DATA   #
######################################
oaiAdapter.digDocRegistrationXsdUrl=http://resolver.nkp.cz/api/v3/digDocRegistration.xsd
oaiAdapter.digInstImportXsdUrl=http://resolver.nkp.cz/api/v3/digInstImport.xsd

###################
#   REPORT FILE   #
###################
oaiAdapter.reportFile=/home/martin/tmp/oaiAdapter/report.txt

}}}


 