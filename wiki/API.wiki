#summary Popis aplikačního programového rozhraní
#labels API,Featured,Phase-Implementation
<wiki:toc max_depth="2" />
=Aplikační programové rozhraní=

API systému slouží zejména k dvěma základním účelům:
 # Vkládání metadatových záznamů a zároveň rezervování urn:nbn identifikátoru pro publikaci popsanou tímto záznamem.
 # Zobrazení záznamu digitálního dokumentu nebo přesměrování do konkrétní digitální knihovny na základě hodnotu urn:nbn (_rezolvování_).
Dále rozhraní umožňuje:
 # Zobrazení záznamů registrátorů, stavu každého urn:nbn, hodnoty registrar-scope identifikátoru vybraného typu.
 # Rezervaci balíku URN:NBN, zobrazení celkového počtu rezervovaných URN:NBN.
 # Pro konkrétní digitální dokument vkládání/editaci/odstranění registrar-scope identifikátorů.
 # Rezolvování na základě trojice
   * kódu registrátora,
   * typu registrar-scope identifikátoru,
   * hodnoty registrar-scope identifikátoru.

Jedná se o *RESTful webové API*. Pro autentizaci je použita metoda _Basic access authentication_. Operace, které jsou autorizované, jsou dostupné jen přes _HTTPS_, čímž je zabráněno zachycení loginu a hesla, které jinak metoda posílá v otevřené formě. Při pokusu o provedení operace přes _HTTP_ bude vrácen kód 301 s přesměrováním na stejné _URL_, ale s prefixem _https://_. Je na administrátorovi, aby zpřístupnil alespoň tyto části aplikace přes _HTTPS_. 

=Verze API=

==~~verze 1~~== 
Za první verzi API je považováno API předchozí implementace Resolveru, viz http://code.google.com/p/urnnbnresolver/. API obsahovalo jen rezolvování. Tato verze API není nadále podporována.

==verze 2==
 * uri prefix */api/v2/*
 * První verze aktuální implementace. Ukázky vstupních a výstupních dat jsou dostupné [http://code.google.com/p/urnnbn-resolver-v2/wiki/apiV2 zde]. 
 * Tato verze API je stále funkční, je ale doporučeno přejít na V3 (v2 deprecated). 
 * Vstupní data ve formátu API v2 jsou transformována na data ve formátu API v3 a poté volány operace API v3.
 * Odpovědi jsou ve formátu API v2. 

Vstupní data musí být validní:
 * podle http://resolver.nkp.cz/api/v2/digDocRegistration.xsd pro registraci digitálního dokumentu
 * podle http://resolver.nkp.cz/api/v2/digInstImport.xsd pro import digitální instance

Podrobná specifikace API v2 je dostupná [https://docs.google.com/spreadsheet/ccc?key=0Ag5aMq4LaXVcdGxGVUFITE1lVUk5blkyZ2ZIc3RuT1E zde].

==verze 3==
Aktuálně preferovaný způsob importu dat představuje API v3.
Oproti V2 došlo k následujícím změnám:
 * uri prefix */api/v3/*
 * sjednocen formát výstupů všech operací. Ty jsou nově všechny validovatelné (_http://resolver.nkp.cz/api/v3/response.xsd_)
 * změna jmeného prostoru nejen výstupních xml, ale i vstupních. Namísto _http://resolver.nkp.cz/v2/_ nově _http://resolver.nkp.cz/v3/_.
 * změna url pro rezolvování podle registrar-scope identifikátoru (řetězec "id" nahrazen řetězcem "registrarScopeIdentifier")
 * změna url pro operace vložení/změnu hodnoty, zobrazení hodnoty, odstranění registrar-scope identifikátoru digitálního dokumentu a zobrazení, odstranění všech registrar-scope identifkátorů digitálního dokumentu (řetězec "identifiers" nahrazen řetězcem "registrarScopeIdentifiers")
 * sjednocení pořadí elementů s časovými známkami (created, modified, registered, deactivated) různých typů objektů (xml generováno Resolverem a vraceno v odpovědi).
 * záznam digitální instance vždy obsahuje buď záznam digitální knihovny, nebo alespoň id digitální knihovny. Pro některé případy užití API tak jedna operace nahradí dvě i více operací. Např. zobrazení všech digitálních instancí digitálního dokumentu + zobrazení záznamu digitální instance (pro všechny instance) pro zjištění, jestli pro má digitální dokument instanci ve vybrané digitální knihovně(OAI Adapter).
 * registrace digitálního dokumentu
   * musí být validní podle http://resolver.nkp.cz/api/v3/digDocRegistration.xsd 
   * operace se chová defenzivněji a preferuje realizaci operace před zamítnutím kvůli nedostatkům v datech. Konkrétně to znamená, že nevalidní obsahy elementů issn, isbn, ččnb nebudou použity, obsahy elementů přesahující určený limit budou zkráceny. V předchozí verzi by v obou případech došlo k zamítnutí operace z důvodu nevalidního vstupního dokumentu.
   * nově možné vložit urn:nbn předchůdce. Pokud operace proběhne úspěšně, předchůdce (urn:nbn) je deaktivován.
 * rozšířena množina povolených hodnot _registrar-scope identifikátorů_ 
  * v API v2: *{{{$ - _ . + ! * ' ( ) , : @}}}*
  * v API v3 všechny rezervované a nerezervované znaky podle RFC 3986:
    * rezervované:
      * *{{{! * ' ( ) ; : @ & = + $ , / ? # [ ]}}}*
      * tyto znaky musí být url-encoded    
    * nerervované:
      * číslice
      * písmena anglické abecedy (velké, malé)
      * následující znaky: *{{{- _ . ~}}}*
    * přibyly tedy tyto znaky: *{{{? [ ] ; & = / #}}}*
 * import digitální instance
   * vstupní data musí být validní podle http://resolver.nkp.cz/api/v3/digInstImport.xsd 

Podrobná specifikace API v2 je dostupná [https://docs.google.com/spreadsheet/ccc?key=0Ag5aMq4LaXVcdFZ3MjBOb2s2UlZtb0ZqbV93WWJ4ZGc zde].